<!-- 操作者選択モーダル -->
<div class="modal fade" id="operatorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="operatorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="operatorModalLabel">操作者情報</h5>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <p>現在のシステムでは、ログインユーザーが自動的に操作者として設定されます。</p>
                    <p>操作者名: <strong id="currentUserName">{{ current_user.full_name or current_user.username }}</strong></p>
                </div>
                
                <!-- エラーメッセージ表示エリア -->
                <div class="alert alert-danger d-none" id="operatorErrorMessage"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="setOperatorBtn">確認</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const operatorModal = document.getElementById('operatorModal');
        const setOperatorBtn = document.getElementById('setOperatorBtn');
        
        // エラーメッセージ表示エリア
        const errorMessageArea = document.getElementById('operatorErrorMessage');
        
        // エラーメッセージを表示する関数
        function showErrorMessage(message) {
            errorMessageArea.textContent = message;
            errorMessageArea.classList.remove('d-none');
        }
        
        // エラーメッセージを非表示にする関数
        function hideErrorMessage() {
            errorMessageArea.classList.add('d-none');
            errorMessageArea.textContent = '';
        }
        
        // 確認ボタンクリック時の処理
        setOperatorBtn.addEventListener('click', function() {
            // モーダルを閉じる
            const modal = bootstrap.Modal.getInstance(operatorModal);
            modal.hide();
        });
        
        // ページ読み込み時に操作者が設定されていなければモーダルを表示
        fetch('/operator/api/get_current')
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    const modal = new bootstrap.Modal(operatorModal);
                    modal.show();
                }
            })
            .catch(error => console.error('現在の操作者情報の取得に失敗しました:', error));
    });
</script>