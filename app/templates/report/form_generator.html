{% extends "base.html" %}

{% block title %}フォーム生成 - 倉庫修繕費管理システム{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>フォーム生成</h1>
  
  <div class="card">
    <div class="card-body">
      <form method="POST">
        <div class="mb-3">
          <label for="template_id" class="form-label">テンプレート選択 <span class="text-danger">*</span></label>
          <select class="form-select" id="template_id" name="template_id" required>
            <option value="">選択してください</option>
            {% for template in templates %}
            <option value="{{ template.id }}">
              {{ template.name }} 
              ({% if template.form_type == 'periodic' %}定期自主検査記録表
              {% elif template.form_type == 'battery' %}バッテリー液量点検表
              {% elif template.form_type == 'preshift' %}始業前点検報告書
              {% else %}{{ template.form_type }}{% endif %})
            </option>
            {% endfor %}
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">出力対象</label>
          <div class="form-check">
            <input type="radio" class="form-check-input" id="output_all" name="output_type" value="all" checked>
            <label class="form-check-label" for="output_all">全台出力</label>
          </div>
          <div class="form-check">
            <input type="radio" class="form-check-input" id="output_selected" name="output_type" value="selected">
            <label class="form-check-label" for="output_selected">選択した号機のみ出力</label>
          </div>
          <div class="form-check">
            <input type="radio" class="form-check-input" id="output_blank" name="output_type" value="blank">
            <label class="form-check-label" for="output_blank">空欄で出力</label>
          </div>
        </div>
        
        <div id="forklift-selection" class="mb-3" style="display: none;">
          <label for="forklift_ids" class="form-label">フォークリフト選択</label>
          <select class="form-select" id="forklift_ids" name="forklift_ids" multiple size="10">
            {% for forklift in forklifts %}
            <option value="{{ forklift.id }}">
              {{ forklift.management_number }} - {{ forklift.model }} ({{ forklift.warehouse_group }} {{ forklift.warehouse_number }})
            </option>
            {% endfor %}
          </select>
          <div class="form-text">Ctrlキーを押しながらクリックすると複数選択できます。</div>
        </div>
        
        <div class="mb-3">
          <input type="hidden" name="operator" id="operator" value="{{ current_user.full_name or current_user.username }}">
        </div>
        
        <button type="submit" class="btn btn-primary">フォーム生成</button>
      </form>
    </div>
  </div>
</div>

<script>
  // 「選択した号機のみ出力」を選択した場合にフォークリフト選択を表示
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('input[name="output_type"]').forEach(radio => {
      radio.addEventListener('change', function() {
        if (this.value === 'selected') {
          document.getElementById('forklift-selection').style.display = 'block';
        } else {
          document.getElementById('forklift-selection').style.display = 'none';
        }
      });
    });
  });
</script>
{% endblock %}