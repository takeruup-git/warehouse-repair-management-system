# Windows インストーラー作成手順

このドキュメントでは、倉庫修繕費管理システムのWindows用インストーラーを作成する手順を説明します。

## 必要なツール

1. Python 3.8以上
2. PyInstaller
3. Inno Setup (Windows用インストーラー作成ツール)

## インストール手順

### 1. 必要なパッケージのインストール

```bash
pip install pyinstaller pywin32 winshell
```

### 2. アプリケーションのビルド

以下のコマンドを実行して、アプリケーションをビルドします：

```bash
python build_windows_app.py
```

このコマンドは以下の処理を行います：
- PyInstallerを使用してアプリケーションをビルド
- 初回起動用と通常起動用のバッチファイルを作成
- Inno Setup用のスクリプトファイルを作成

### 3. インストーラーの作成

Inno Setupをインストールした後、以下のコマンドを実行してインストーラーを作成します：

```bash
iscc 倉庫修繕費管理システム.iss
```

または、Inno Setup Compilerを開いて、`倉庫修繕費管理システム.iss`ファイルを読み込み、ビルドボタンをクリックします。

### 4. インストーラーの配布

ビルドが完了すると、`installer`フォルダに`倉庫修繕費管理システム_セットアップ.exe`ファイルが作成されます。
このファイルを配布することで、ユーザーは簡単にアプリケーションをインストールできます。

## インストール後の初回起動

1. インストール完了時に「初回セットアップを実行」オプションを選択するか、
2. スタートメニューまたはデスクトップの「倉庫修繕費管理システム - 初回起動」ショートカットをクリックします。

初回起動時には以下の処理が行われます：
- データベースの初期化
- 管理者ユーザーの作成
- サンプルデータの追加（オプション）

## 通常起動

インストール後の通常起動は、以下のいずれかの方法で行います：
- デスクトップの「倉庫修繕費管理システム」アイコンをクリック
- スタートメニューから「倉庫修繕費管理システム」を選択
- インストールフォルダ内の「倉庫修繕費管理システム.exe」を直接実行

## トラブルシューティング

### データベースエラーが発生する場合

データベースに問題がある場合は、初回起動バッチファイルを再実行してデータベースを再初期化してください。
ただし、この操作を行うと既存のデータはすべて失われますのでご注意ください。

### アプリケーションが起動しない場合

1. コマンドプロンプトから直接実行して、エラーメッセージを確認してください：
   ```
   cd "C:\Program Files\倉庫修繕費管理システム"
   倉庫修繕費管理システム.exe
   ```

2. ログファイルを確認してください：
   ```
   %APPDATA%\倉庫修繕費管理システム\logs\
   ```

## カスタマイズ

インストーラーをカスタマイズする場合は、`倉庫修繕費管理システム.iss`ファイルを編集してください。
アプリケーションの動作をカスタマイズする場合は、`build_windows_app.py`ファイルを編集してください。